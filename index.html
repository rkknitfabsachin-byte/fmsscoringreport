<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Weekly Performance â€“ RK KNIT FAB</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  padding:20px;
  font-family:Poppins, sans-serif;
  background:linear-gradient(135deg,#dfe9f3,#f9fcff);
}

h2{
  text-align:center;
  font-weight:600;
  margin-bottom:25px;
}

/* GLASS CARD */
.card{
  padding:18px;
  margin-bottom:18px;
  border-radius:18px;
  background:rgba(255,255,255,0.55);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.45);
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

/* STEP CARDS GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:15px;
}

/* COLORS */
.green{ border-left:12px solid #28a745; }
.blue{ border-left:12px solid #007bff; }
.yellow{ border-left:12px solid #ffc107; }
.orange{ border-left:12px solid #fd7e14; }
.red{ border-left:12px solid #dc3545; }
.grey{ border-left:12px solid #6c757d; }

.step-title{
  font-size:18px;
  font-weight:600;
}
</style>
</head>

<body>

<h2>Weekly Production Performance</h2>

<div id="weeklyBox"></div>

<h3 style="margin-top:30px;">Step-wise Weekly Scores</h3>
<div class="grid" id="steps"></div>

<canvas id="chart" style="margin-top:30px;"></canvas>

<script>

const API = "https://script.google.com/macros/s/AKfycbxBwOJYL9OIPmsfPKE7s0teHAHp0I7svWM9ww5-_wTHlFXQN2zY7GhqQvga5tBopJcj/exec";

let weeklyData = {};
let stepScores = [];

async function loadData(){
  const res = await fetch(API);
  const json = await res.json();
  weeklyData = json.weeklyTotals;
  stepScores = json.stepScores;
  renderSummary();
  renderSteps();
  renderChart();
}

function renderSummary(){
  document.getElementById("weeklyBox").innerHTML = `
    <div class="card">
      <h3>Weekly Summary</h3>
      <p><b>Total Planned:</b> ${weeklyData.plannedCount}</p>
      <p><b>Total Actual:</b> ${weeklyData.actualCount}</p>
      <p><b>On-Time:</b> ${weeklyData.onTime}</p>
      <p><b>Late:</b> ${weeklyData.late}</p>
      <p><b>Very Late:</b> ${weeklyData.veryLate}</p>
      <p><b>Overdue:</b> ${weeklyData.overdue}</p>
    </div>
  `;
}

function getColor(score){
  if(score > 5) return "green";
  if(score > 0) return "blue";
  if(score === 0) return "grey";
  if(score < -5) return "red";
  return "yellow";
}

function renderSteps(){
  let html = "";

  stepScores.forEach(s => {
    html += `
      <div class="card ${getColor(s.score)}">
        <div class="step-title">${s.step}</div>
        <p>Weekly Score: <b>${s.score}</b></p>
      </div>
    `;
  });

  document.getElementById("steps").innerHTML = html;
}

function renderChart(){
  const ctx = document.getElementById("chart").getContext("2d");

  new Chart(ctx, {
    type: "bar",
    data: {
      labels: stepScores.map(s => s.step),
      datasets: [{
        label: "Weekly Score",
        data: stepScores.map(s => s.score),
        borderWidth: 1
      }]
    }
  });
}

loadData();

</script>

</body>
</html>
