<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Weekly Performance â€“ RK KNIT FAB</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  padding:20px;
  font-family:Poppins, sans-serif;
  background:linear-gradient(135deg,#dfe9f3,#f9fcff);
}

h2{
  text-align:center;
  font-weight:600;
  margin-bottom:25px;
}

.card{
  padding:20px;
  border-radius:18px;
  background:rgba(255,255,255,0.6);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.4);
  margin-bottom:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:15px;
}

.red{ border-left:12px solid #dc3545; }
.yellow{ border-left:12px solid #ffc107; }
.green{ border-left:12px solid #28a745; }

.score-value{
  font-size:20px;
  font-weight:700;
}
</style>
</head>

<body>

<h2>Weekly Negative Gap Analysis</h2>

<div id="overall"></div>

<h3>Step-wise Negative Score</h3>
<div class="grid" id="steps"></div>

<canvas id="chart" style="margin-top:40px;"></canvas>

<script>

const API = "https://script.google.com/macros/s/AKfycbxBwOJYL9OIPmsfPKE7s0teHAHp0I7svWM9ww5-_wTHlFXQN2zY7GhqQvga5tBopJcj/exec";

let overallScore = 0;
let stepScores = [];

async function loadData(){
  const raw = await fetch(API);
  const json = await raw.json();

  overallScore = json.overallScore;
  stepScores = json.stepScores;

  renderOverall();
  renderSteps();
  renderChart();
}

function colorScore(s){
  if (s >= -20) return "green";
  if (s >= -50) return "yellow";
  return "red";
}

function renderOverall(){
  document.getElementById("overall").innerHTML = `
    <div class="card ${colorScore(overallScore)}">
      <h3>Overall Weekly Score</h3>
      <div class="score-value">${overallScore}</div>
      <p>-1 = Excellent, -100 = Worst</p>
    </div>
  `;
}

function renderSteps(){
  let out = "";

  stepScores.forEach(s => {
    out += `
      <div class="card ${colorScore(s.score)}">
        <div style="font-size:18px;font-weight:600">${s.step}</div>
        <div class="score-value">${s.score}</div>
      </div>
    `;
  });

  document.getElementById("steps").innerHTML = out;
}

function renderChart(){
  const ctx = document.getElementById("chart").getContext("2d");

  new Chart(ctx,{
    type:"bar",
    data:{
      labels:stepScores.map(s=>s.step),
      datasets:[{
        label:"Negative Score",
        data:stepScores.map(s=>s.score),
        borderWidth:1
      }]
    }
  });
}

loadData();

</script>
</body>
</html>
